# Generated by Django 4.2.2 on 2023-07-14 21:31

from django.db import migrations


def convert_msg_types(apps, schema_editor):  # pragma: no cover
    Msg = apps.get_model("msgs", "Msg")

    num_updated = 0

    while True:
        id_batch = list(Msg.objects.filter(msg_type__in=("I", "F")).values_list("id", flat=True)[:1000])
        if not id_batch:
            break

        Msg.objects.filter(id__in=id_batch).update(msg_type="T")
        num_updated += len(id_batch)

        print(f"Updated {num_updated} messages with old msg type values")


def reverse(apps, schema_editor):  # pragma: no cover
    pass


class Migration(migrations.Migration):
    dependencies = [("msgs", "0243_fix_archived_label_counts")]

    operations = [migrations.RunPython(convert_msg_types, reverse)]
