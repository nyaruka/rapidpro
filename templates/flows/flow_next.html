{% extends "smartmin/base.html" %}
{% load temba i18n %}

{% block title %}
  <div class="flex">
    <div class="flex items-center text-gray-600">
      {% if object.flow_type == 'V' %}
        <temba-icon name="flow_ivr" class="mr-3">
        </temba-icon>
      {% elif object.flow_type == 'B' %}
        <temba-icon name="flow_background" class="mr-3">
        </temba-icon>
      {% endif %}
    </div>
    <div id="title-text">{{ title }}</div>
  </div>
{% endblock title %}
{% block extra-style %}
  {{ block.super }}
  <style type="text/css">
    .spa-content {
      padding-left: 0px !important;
      padding-right: 0px !important;
      padding-bottom: 0px !important;
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
    }

    .no-menu {
      padding: 0 1em;
    }

    .spa-footer {
      display: none;
    }

    temba-flow-editor {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      width: 100%;
      border-top: 1px solid #e7e7e7;
    }
  </style>
{% endblock extra-style %}
{% block extra-script %}
  {{ block.super }}
  <script type="text/javascript">
    function leaveBetaEditor() {
      document.cookie = 'use_beta_editor=; path=/; max-age=0';
      window.location.href = '/flow/editor/{{object.uuid}}/';
    }

    function handleContactClicked(e) {
      const contactUuid = e.detail.uuid;
      spaGet("/contact/read/" + contactUuid + "/");
    }

    function handleFollow(event) {
      const {
        flowUuid,
        nodeUuid
      } = event.detail;

      // Get the editor element
      const editor = document.querySelector('temba-flow-editor');

      if (editor) {
        // Only focus if we're on the same flow for now
        if (editor.flow !== flowUuid) {
          // spaGet("/flow/next/" + flowUuid + "/");
        } else {
          editor.focusNode(nodeUuid);
        }
      }
    }
  </script>
{% endblock extra-script %}
{% block content %}
  <temba-flow-editor flow="{{ object.uuid }}" -temba-contact-clicked="handleContactClicked">
  </temba-flow-editor>
  <temba-simulator flow="{{ object.uuid }}" -temba-follow-simulation="handleFollow">
  </temba-simulator>
{% endblock content %}
